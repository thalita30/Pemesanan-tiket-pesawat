<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pemesanan Tiket Pesawat</title>
    <!-- Hubungkan CSS -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Pemesanan Tiket Pesawat</h1>
      <form id="form">
        <input id="name" placeholder="Nama" required />
        <input id="email" type="email" placeholder="Email" required />
        <select id="destination" required></select>
        <input id="passengers" type="number" value="1" min="1" required />
        <select id="payment">
          <option value="cash">Cash</option>
          <option value="transfer">Transfer Bank</option>
          <option value="ewallet">E-Wallet</option>
        </select>
        <button type="submit">Pesan Tiket</button>
      </form>
      <div id="result"></div>
    </div>

    <script>
      async function loadCountries() {
        const res = await fetch("/api/countries");
        const data = await res.json();
        const select = document.getElementById("destination");
        data.forEach((c) => {
          const opt = document.createElement("option");
          opt.value = c.code;
          opt.textContent = `${c.name} - Rp${c.price.toLocaleString("id-ID")}`;
          select.appendChild(opt);
        });
      }
      loadCountries();

      document.getElementById("form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const res = await fetch("/api/book", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            destinationCode: document.getElementById("destination").value,
            passengers: Number(document.getElementById("passengers").value),
            paymentMethod: document.getElementById("payment").value,
          }),
        });
        const data = await res.json();
        if (data.success) {
          const b = data.booking;
          document.getElementById("result").innerHTML = `
        <h3>Pesanan Berhasil!</h3>
        <p>ID: ${b.id}</p>
        <p>Nama: ${b.name}</p>
        <p>Tujuan: ${b.destination}</p>
        <p>Total: Rp${b.total.toLocaleString("id-ID")}</p>
        <p>Metode Bayar: ${b.paymentMethod}</p>
      `;
        } else {
          alert("Gagal memesan");
        }
      });
    </script>
  </body>
</html>
